var timehandler=null;var usedConsole={1:false};var isFlashWS=false;var WebSocket=WebSocket||function(b){isFlashWS=true;if(typeof a=="undefined"){var a=""}var g=a+"/swf/WebSocket.swf";var c=Math.random()*1000000000|0;var h={};this.readyState=0;var j=["open","message","close","error"];for(var f=0;f<j.length;f++){(function(k,l){var i=h[l]=[];window[l+c]=function(n){if(typeof k["on"+l]=="function"){k["on"+l](n)}for(var m=0;m<i.length;m++){i[m](n)}};if(l=="open"){window["state"+c]=function(m){k.readyState=m}}})(this,j[f])}this.addEventListener=function(k,i){h[k].push(i)};this.removeEventListener=function(n,m){for(var k=0,l=h[n];k<l.length;k++){if(l[k]==m){l.splice(k,1);k=l.length}}};this.send=function(i){window["WebSocket"+c].send(i)};this.close=function(){window["WebSocket"+c].close()};var d=b.match(/\/\/([\w.]+)(?::(\d+))?(.*$)/);d=["id="+c,"port="+(d[2]||80),"host="+d[1],"path="+(d[3]||"/"),"key="+document.cookie].join("&");var e=['<object width="0" height="0" ','type="application/x-shockwave-flash" ','id="WebSocket'+c+'" data="'+g+'">','<param name="Movie" value="'+g+'" />','<param name="FlashVars" value="'+d+'" />',"</object>"].join("");document.body?document.body.insertAdjacentHTML("beforeend",e):document.write(e)};function ajaxMessage(){if(typeof webRoot=="undefined"){webRoot=""}var a=["notice"];$.ajax({url:webRoot+"/message/new-msg/",type:"POST",dataType:"json",attribute:"ignore",success:function(f){if(f.flag){$(".alertNotice li.noRead").remove();for(var c in f.ret){var d=(c=="application"?"审批申请":c=="msg"?"站内信":"公告");var e=(c=="application"?"/application/messages/":c=="msg"?"/notice/inner-msg/":"/notice/center/");var b=(c=="application"?"applicationCheck":c=="msg"?"innerMsg":"notice");var e=webRoot+e;var h=f.ret[c];if(h.length==0){var j='<li class="noRead {0}"><div class="clearfix topPart"><span class="title">{1}(0)</span><a data-href="{2}" class="more-link {3}" onclick="clearMsg(this)">更多></a></div></li>'.format(c+"Info",d,e,"more-"+b);$(".alertNotice .downTabs").append(j)}else{var g=in_array(parseInt(h.type),a)?'target="_blank"':"";var j='<li class="noRead '+c+'Info"><div class="clearfix topPart"><span class="title">'+d+'(1)</span><a data-href="'+e+'" class="more-link more-'+b+'" onclick="clearMsg(this)">更多></a></div><div class="clearfix bottom">'+'<span class="contentText">{0} <a onclick="clearMsg(this)" data-href="{1}" {2} data-type="{3}" data-id="{5}" tp1="平台" tp2="首页header" tp3="点击某条消息" tp4="{6}">{4}</a></span> '.format(h.content,h.url,g,h.type,h.msg,h.id,h.content)+'<span class="time">{0}</span>'.format(new Date(parseInt(h.time)*1000).toLocaleString().substr(0,9))+"</div></li>";$(".alertNotice .downTabs").prepend(j)}}if($(".alertNotice .noRead .bottom .contentText").length>0){$(".alertNotice").addClass("active")}else{$(".alertNotice").removeClass("active")}}}})}function clearMsg(b){if($(b).hasClass("more-link")){var a=$(b).parents(".noRead").find(".bottom a").data("type")}else{var a=$(b).data("type")}if(a){$.ajax({url:webRoot+"/message/clear-msg",type:"POST",dataType:"json",data:{type:a},success:function(c){if(c.flag){window.location.href=$(b).data("href")}else{Doalert(c.error)}}})}else{window.location.href=$(b).data("href")}}function connect(b){try{var a=new WebSocket(b);if(!isFlashWS){console.log("Socket Status: "+a.readyState+"(connect)")}a.onopen=function(){if(!isFlashWS){console.log("Socket Status: "+a.readyState+" (open)")}};a.onmessage=function(e){if(e.data!="heart-beat"){var d=$.parseJSON(e.data);if(d.flag){getUnReadMessage()}else{if(!isFlashWS){console.log(d.error)}}}};a.onclose=function(){if(!isFlashWS){console.log("Socket Status: "+a.readyState+" (Closed)")}}}catch(c){if(!isFlashWS){console.log("Socket Status: ERROR: (Closed)")}}}function backToTop(){var a=$(document).scrollTop();if(a>0){$(".layer_top").show()}else{$(".layer_top").hide()}}function reloadBody(){var a=$(window).height();$("body>.bodywrap").css("min-height",a+"px")}var lastMessageTime=null;function getUnReadMessage(){if(lastMessageTime&&+new Date()-lastMessageTime<1000){return}lastMessageTime=+new Date();clearInterval(timehandler);ajaxMessage();timehandler=setInterval(ajaxMessage,300000)}function browserRedirect(){var c=navigator.userAgent.toLowerCase();var g=c.match(/ipad/i)=="ipad";var h=c.match(/iphone os/i)=="iphone os";var f=c.match(/midp/i)=="midp";var d=c.match(/rv:1.2.3.4/i)=="rv:1.2.3.4";var e=c.match(/ucweb/i)=="ucweb";var a=c.match(/android/i)=="android";var b=c.match(/windows ce/i)=="windows ce";var i=c.match(/windows mobile/i)=="windows mobile";if(g||h||f||d||e||a||b||i){return"phone"}else{return"pc"}}document.ondragstart=function(){return false};var imageArr=[];var imageIndex=0;var imageZoom=1;var imageWidth=0;var imageTop=0;var browser=browserRedirect();showImages.zoom="zoom";showImages.scroll="scroll";function showImages(l){$("#showImageBox").remove();var e='<div class="showImageBox" id="showImageBox"><span class="showImage-left" id="showImage-left"></span><span class="showImage-right" id="showImage-right"></span><span class="showImage-close" id="showImage-close">×</span><img src="//cdn.wetest.qq.com/platform/2.4.6/img/source/error.gif" class="showImage" id="showImage" draggable="false"></div>';$(document).find("body").append(e);$("#showImageBox").click(function(){hideImages()});$("#showImage-left").click(function(m){stopBubble(m);changeImage("left")});$("#showImage-right").click(function(m){stopBubble(m);changeImage("right")});$("#showImage-close").click(function(){hideImages()});$("#showImage").click(function(m){stopBubble(m)});document.getElementById("showImage").onerror=function(){this.onerror=null;this.src="//cdn.wetest.qq.com/platform/2.4.6/img/source/error.gif"};var b={url:[],index:0,mousewheel:showImages.zoom,scrollValue:100};l=$.extend({},b,l);imageArr=l.url;imageIndex=l.index;$("#showImage").removeClass("scroll");$("#showImageBox").show();if(l.mousewheel=="scroll"){$("#showImage").addClass("scroll")}if(browser=="pc"){if($("#showImageBox").attr("data-mousewheel")!=1){$("#showImageBox").mousewheel(function(m){switch(l.mousewheel){case"zoom":if(m.deltaY>0){imageZoom+=0.1}else{if(m.deltaY<0){imageZoom-=0.1;imageZoom=imageZoom<=0?0:imageZoom}}isImageHigh();$("#showImage").css("width",imageZoom.toFixed(1)*imageWidth+"px");Dotoast(parseInt(imageZoom.toFixed(1)*100)+"%");break;case"scroll":imageTop=$("#showImage").position().top;if(m.deltaY>0){imageTop+=l.scrollValue}else{if(m.deltaY<0){imageTop-=l.scrollValue}}imageTop=Math.min(imageTop,0);imageTop=Math.max(imageTop,-parseInt($("img#showImage[moveImg=1]").height()-$(window).height()));$("img#showImage[moveImg=1]").css("top",imageTop);break}return false});$("#showImageBox").attr("data-mousewheel",1)}}else{$("#showImageBox").addClass("mobile");var c=document.getElementById("showImageBox");var f=0;var d=0;var j=0;var i=0;var h=0;var g=0;var a=0;var k=0;if($("#showImageBox").attr("data-touchs")!=1){c.addEventListener("touchstart",function(m){a=1;f=m.touches[0].clientX;d=m.touches[0].clientY;g=m.touches[0].clientY},false);c.addEventListener("touchmove",function(m){m.preventDefault();if(a==1){j=m.touches[0].clientX;i=m.touches[0].clientY;if(j-f>100){changeImage("left");a=0}else{if(j-f<-100){changeImage("right");a=0}else{imageTop=$("#showImage").position().top;imageTop+=i-g;imageTop=Math.min(imageTop,0);imageTop=Math.max(imageTop,-parseInt($("img#showImage[moveImg=1]").height()-screen.height));$("img#showImage[moveImg=1]").css("top",imageTop)}}h=m.touches[0].clientX;g=m.touches[0].clientY}},false);c.addEventListener("touchend",function(m){a=0},false);c.addEventListener("touchcancel",function(m){a=0},false);$("#showImageBox").attr("data-touchs",1)}}changeImage()}function stopBubble(a){if(a&&a.stopPropagation()){a.stopPropagation()}else{if(window.event){window.event.cancelBubble=true}}}function hideImages(){$("#showImageBox").hide();$("#showImageBox").unbind("mousewheel").attr("data-mousewheel",0)}function changeImage(a){if(a=="left"){imageIndex--;if(imageIndex<0){imageIndex=0;Dotoast("已是首张图片");return}}else{if(a=="right"){imageIndex++;if(imageIndex>imageArr.length-1){imageIndex=imageArr.length-1;Dotoast("没有更多图片");return}}}var b=imageArr[imageIndex];$("#showImage").attr("src",b).removeAttr("moveImg");$("#showImage").stop().fadeOut(0).load(function(){imageOnload()})}function isImageHigh(){if($("#showImage").height()>$(window).height()){$("#showImage").attr("moveImg",1).css({top:0,transform:"translate(-50%,0)"});bindImageMove()}else{$("#showImage").attr("moveImg",0).css({top:"50%",transform:"translate(-50%,-50%)"})}}function imageOnload(){isImageHigh();$("#showImage").width("auto");imageZoom=1;imageWidth=$("#showImage").width();$("#showImage").stop().fadeIn(500)}function bindImageMove(){var b;var a;$("img#showImage[moveImg=1]").mousedown(function(c){imageTop=parseInt($(this).css("top"));b=c.clientY;a=true});$("img#showImage[moveImg=1]").mousemove(function(d){if(a){var f=d.clientY;var c=imageTop+(f-b);c=Math.min(c,0);c=Math.max(c,-parseInt($("img#showImage[moveImg=1]").height()-$(window).height()));$("img#showImage[moveImg=1]").css("top",c)}});$("img#showImage[moveImg=1]").mouseup(function(c){a=false});$("img#showImage[moveImg=1]").mouseout(function(c){a=false})}var DoToastTimer;function Dotoast(a){if($("#showToasts")){clearTimeout(DoToastTimer);$("#showToasts").text(a).show();DoToastTimer=setTimeout(function(){$("#showToasts").text("").stop().hide(200)},2000)}}document.onReady&&document.onReady(function(){if(typeof WS_HOST!="undefined"&&!in_array(window.location.host,["fsight.qq.com","fsight.openqa.qq.com","fsightpub.qq.com"])){connect(WS_HOST);getUnReadMessage()}reloadBody();$(window).resize(reloadBody);$(window).bind("scroll",backToTop);$(".layer_top").on("click",function(){$("html, body").animate({scrollTop:0},$(this).offset().top/7)})});